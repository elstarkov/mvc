{% extends "base.html.twig" %}

{% block title %}Metrics{% endblock %}

{% block body %}

<br>
<h2>Clean Code</h2>
<hr>

<h3>Introduktion</h3>

<p>
    På den här sidan kommer källkoden bakom hemsidans uppbyggnad analyseras med hjälp av verktygen PHPMetrics
    och Scrutinizer. Verktygen kommer i första hand att bedöma koden utifrån sex olika kriterier. Vi kallar
    kriterierna för "de sex C:na". Kriterierna finns listade nedan:
</p>
    <ul>
        <li>Codestyle</li>
        <li>Coverage</li>
        <li>Complexity</li>
        <li>Cohesion</li>
        <li>Coupling</li>
        <li>CRAP</li>
    </ul>

<p>
    Med hjälp av kriterierna kan verktygen generera mätvärden och betyg på koden. 'Codestyle' är ett mer generellt betyg
    för kodens kvalitet och hur väl den förhåller sig till det använda språkets struktur och riktlinjer. 'Coverage' syftar
    till hur väl koden är testad. Ett högt 'coverage' är en typ av kvalitetsstämpel och bevis på vältestad kod. 'Complexity'
    handlar om kodens komplexitet. Hög komplexitet innebär risk för kod som är svår att underhålla. Det kan göra koden känslig
    för uppdateringar i framtiden. 'Cohesion' beskriver hur väl metoder i en klass verkligen hör ihop med klassen. Man vill ha
    en hög 'Cohesion' vilket ger ett lågt värde i testet. Det indikerar på att klassen och dess tillhörande metoder och variabler
    är lättare att förstå och underhålla. Man kan se det som ett kvitto på att de förhåller sig till sina tilltänkta uppgifter.
    'Coupling' handlar om hur olika klasser är kopplade till varandra. En klass kan undersökas utifrån två olika typer av 'Coupling'.
    'Afferent coupling (AC)' beskriver hur många klasser som är beroende av den aktuella klassen. 'Efferent coupling (EC)' beskriver
    tvärt om hur många klasser som den aktuella klassen är beroende av. Det finns inga rätt eller fel men det kan vara värt att se
    över sina klasser om man märker att en ha väldigt stort inflytande. Det sista huvudsakliga kriteriet är 'CRAP'. CRAP kan ses som
    ett mått på risk. Det undersöker hur vältestad en bit kod är utifrån dess komplexitet. Om koden är komplex bör den ha motsvarande
    mängd tester. Komplex kod som inte är vältestad kommer generera ett högre 'CRAP-score'. Det finns fler kriterier för att mäta kodens
    kvalitet men i den här analysen kommer dessa vara de huvudsakliga men det är möjligt att andra kriterier nämns om det skulle vara
    rimligt.
</p>
<p>
    Med kriterierna förklarade så kan en kort kommentar om min egen kod vid ett första anblick ges. I det stora hela genereras ett gott betyg
    men det som sticker ut tydligt är den låga procenten för 'Coverage'. Tittar man lite närmare så förstår man att det är samtliga "Controllers"
    som ger problem. Anledningen är att det inte finns några tester skrivna för dessa då de endast har som uppgift att rendera olika webbkomponenter.
    Webbkomponenterna använder i sin tur klasser. För dessa klasser finns det redan enhetstester. Som lösning på kritiken ställs nu författaren inför
    valet att antingen skriva tester även för 'Controllers' eller välja att exkludera dessa när verktygen körs.
</p>

<h3>PHPMetrics</h3>

<p>
    Verktyget PHPMetrics genererar en rapport som går att öppna i webbläsaren. Som det nämndes tidigare så är det i huvudsak kategorin 'Controllers'
    som inte uppfyller kraven. Vi har redan varit inne på varför och hur man skulle kunna lösa problemen. Om man studerar rapporten närmare så går det
    också att förstå att även koden för själva enhetstesterna bedöms utifrån hur vältestad den är. Det här blir helt fel eftersom koden enbart
    finns för att testa koden i de klasser som webbplatsen använder. Det behövs inga tester för att testa testerna. Vi kan utgå ifrån att koden
    bakom modulen för enhetstestning är korrekt. Som lösning på detta bör nog konfigurationsfilen ses över. Testklasserna bör exkluderas från verktygets
    bedömning. Övriga noteringar är att klasserna som har centrala roller i kortspelet har de högsta värdena för 'Coupling'. Det låter rimligt eftersom
    de ansvarar för korthänder, kortleken samt varje enskilt kort i leken. Det här är klasser som är beroende av varandra och det skulle vara svårt att
    skapa ett fungerande kortspel om de inte var det även om det innebär ett högre coupling-värde.
</p>
<p>
    Följande bild sammanfattar läget bra. Den beskriver komplexiteten med en illustration. De röda cirklarna är samtliga Controllers. De har ett komplexitets-värde
    runt 18 medan de gröna cirklarna ligger mellan ett och tre. Som ett extra mått kan man också utläsa att ökad komplexitet kan leda till svårunderhållen kod.
    Vi bör nog ta en titt på Controller-klasserna.
</p>
    <img src="{{ asset('img/phpmetrics.png') }}" alt="">

<h3>Scrutinizer</h3>

<p>
    Scrutinizer är det andra verktyget som används i analysen. Det här verktyget går att använda för olika kodspråk medan PHPMetrics är mer utformat
    för PHP-kod. Oavsett språk så finns det många gemensamma mål man vill uppfylla för koden ska vara i så gott skick som möjligt. Scrutinizer erbjuder
    oss fordelen att få olika delar av koden summerade med hjälp av badges. Vi kollar:
</p>

    <img src="https://scrutinizer-ci.com/g/elstarkov/mvc/badges/quality-score.png?b=main" alt="quality">

    <img src="https://scrutinizer-ci.com/g/elstarkov/mvc/badges/coverage.png?b=main" alt="coverage">

    <img src="https://scrutinizer-ci.com/g/elstarkov/mvc/badges/build.png?b=main" alt="build">

    <img src="https://scrutinizer-ci.com/g/elstarkov/mvc/badges/code-intelligence.svg?b=main" alt="code intelligence">

<p>
    Vid det här laget är vi inte längre förvånande. Det är tydligt att andel code coverage skiljer sig avsevärt från övriga delar.


{% endblock %}